####################################################################################
#######################  GENERAL DESCRIPTION OF FUNCTIONS  #########################

# Global variables, jail/quBSD parameters, sanity checks, messages, networking.
# Functions embed many sanity checks, but also call other functions to assist.
# Messages are sourced from a separate script, as a function. They have the form:
#   get_msg <$_q> -m <_msg_ident> <_pass_variable1> <_pass_variable2>
#     <$_q> (q)uiet option.
#        -note- /bin/sh passes local vars to new functions called within functions.
#               thus to prevent inadvertently passing [-q], important funcitons
#               have a unique _q identifier.
#     <_msg_ident> Is used to retreive a particular message from the msg function.
#     <_pass_variable> 1 and 2 are for supplementing message specificity.

# Functions can assign global variables and deliver error messages ;
# but they almost never make a determination to exit. That is left to the caller.


####################################################################################
###############################  LIST OF FUNCTIONS  ################################

####################  VARIABLES VALUES and HIGH LEVEL FUNCTIONS  ###################
# get_global_variables - File names/locations ; ZFS datasets
# rm_errfiles          - Removes the coordinated error files for qb-scripts
# get_parameter_lists  - Valid parameters are tracked here, and divided into groups
# get_user_response    - Simple yes/no y/n checker
# get_jail_parameter   - All QCONF entries, along with sanity checks
# get_info             - Info beyond that just for jails or jail parameters
	# _CLIENTS          - All jails that <jail> serves a network connection
	# _ONJAILS          - All currently running jails
	# _USED_IPS         - All IPs used by currently running jails
	# _XID              - Window ID for the currently active X window
	# _XJAIL            - Jailname (or 'host') for the currently active X window
	# _XNAME            - Name of the process for the current active X window
	# _XPID             - PID for the currently active X window
# compile_jlist        - Used for qb-start/stop, to get list of jails to act on
# create_popup         - Generic function used for popups
# calculate_sizes      - Calculate window and font size for message popups

#########################  JAIL/VM  HANDLING and ACTIONS  ##########################
# start_jail           - Performs checks before starting, creates log
# stop_jail            - Performs checks before starting, creates log
# restart_jail         - Self explanatory
# reclone_zroot        - Destroys and reclones jails dependent on ROOTENV
# reclone_zusr         - Destroy and reclones jails with zusr dependency (dispjails)
# select_snapshot      - Find/create ROOTENV snapshot for reclone.
# configure_ssh_control- SSH keys for control jail are copied over to running env.
# monitor_startstop    - Monitors whether qb-start or qb-stop is still alive
# monitor_vm_stop      - Monitors whether qb-start or qb-stop is still alive
# launch_xephyr        - For qb-cmd, manages the lifecycle of Xephyr windows

#################################  STATUS  CHECKS  #################################
# chk_isblank          - Posix workaround: Variable is [-z <null> OR [ \t]*]
# chk_isrunning        - Searches jls -j for the jail
# chk_truefalse        - When inputs must be either true or false
# chk_integer          - Checks that a value is an integer, within a range
# chk_avail_jailname   - Checks that a proposed jailname is acceptable
# get_jail_shell       - Gets the SHELL for a particular jail

#################################  SANITY  CHECKS  #################################
# chk_valid_zfs        - Checks for presence of zfs dataset. Redirect to null
# chk_valid_jail       - Makes sure the jail has minimum essential elements
# chk_valid_autosnap   - true|false ; Include in qb-autosnap /etc/crontab snapshots
# chk_valid_autostart  - true|false ; Autostart at boot
# chk_valid_bhyveopts  - Checks bhyve options in QCONF for valid or not
# chk_valid_class      - appjail | rootjail | dispjail | appVM | rootVM
# chk_valid_cpuset     - Must be in man 1 cpuset format. Limit jail CPUs
# chk_valid_gateway    - Jail adheres to gateway jail norms
# chk_valid_ipv4       - Adheres to CIDR notation
# chk_isqubsd_ipv4     - Adheres to quBSD conventions for an IP address
# chk_valid_maxmem     - Must be in man 8 rctl format. Max RAM allocated to jail
# chk_valid_memsize    - Check memsize for bhyve (just references _valid_maxmem)
# chk_valid_mtu        - Must be a number, typically between 1000 and 2000
# chk_valid_no_destroy - true|false ; qb-destroy protection mechanism
# chk_valid_ppt        - Checks ppt exists in pciconf and is available to passthru
# chk_valid_rootenv    - Only certain jails/VMs can be used as a ROOTENV
# chk_valid_schg       - none | sys | all ; quBSD convention, schg flags on jail
# chk_valid_seclvl     - -1|0|1|2|3 ; Applied to jail after start
# chk_valid_template   - Somewhat redundant with: chk_valid_jail
# chk_valid_taps       - QCONF designates number of taps to add (must be :digit:)
# chk_valid_tmux       - tmux for terminal access to FreeBSD jails. true/false
# chk_valid_template   - Must be any valid jail
# chk_valid_vcpus      - Must be an integer less than cpuset -g
# chk_valid_vnc        - Must be one of few valid resolutions allowed by bhyve
# chk_valid_vif        - Virtual Intf (vif) is valid
# chk_valid_wiremem    - Must be true/false

##############################  NETWORKING  FUNCTIONS  #############################
# remove_interface     - Removes tap interface from whichever jail it's in
# discover_open_ipv4   - Finds an unused IP address from the internal network
# connect_client_to_gateway - Connects a client jail to its gateway

##################################  VM  FUNCTIONS  #################################
# cleanup_vm           - Cleans up network connections, and dataset after shutdown
# return_ppt           - Set PPT devices back to original state before VM launch.
# prep_bhyve_options   - Retrieves VM variables and handles related functions
# launch_bhyve_vm      - Launches the VM to a background subshell
# exec_vm_coordinator  - Coordinates the clean launching and teardown of VMs

##################################  DEBUG LOGGING  #################################
# setlog1              - For turning on debug log to /root/debug1
# setlog2              - For turning on debug log to /root/debug2

